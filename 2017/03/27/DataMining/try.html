<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  <style type="text/css">
    body, html{width: 100%;height: 100%;margin:0;font-family:"微软雅黑";}
    #allmap{height:500px;width:100%;}
    #r-result{width:100%;}
  </style>
  <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=YwWi03lnWkPO77pwhlsvNttVT9HeChOS"></script>
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <title>轨迹投影</title>
</head>
<body>
  <div id="allmap" style="height: 900px"></div>
</body>
</html>

<script type="text/javascript">
  // 百度地图API功能

  var map = new BMap.Map("allmap");
  map.setMapStyle({        
    styleJson: [
    {            
      "featureType": "subway", 
      "elementType": "all",            
      "stylers": {                
        "visibility": "off"            
      }        
    },{            
      "featureType": "highway", 
      "elementType": "all",            
      "stylers": {                
        "visibility": "off"            
      }        
    },{            
      "featureType": "railway", 
      "elementType": "all",            
      "stylers": {                
        "visibility": "off"            
      }        
    }
    ]    
  });


  var point = new BMap.Point(121.512615, 31.212465);
  map.centerAndZoom(point, 13);


  points = [];
  point = [];

  ids = [ '369', '604', '206', '937'].sort();
  target = ['15', '250', '480', '690', '900'].sort();
  id = 1;
  reg = 0;

  d3.csv('Traj_1000_SH_GPS.GPS', function(error, data){
    for(var i = 0; i < data.length; i ++){
      var tid = data[i].Tid;
      var lon = data[i].Lon;
      var lat = data[i].Lat;

      if (id != tid){
        draw(reg, id, points);
        points = [];
        id += 1;
      }

      point = [lon, lat];
      points.push(point);

      if(target.indexOf(tid) >= 0) reg = 0;
      else if(ids.indexOf(tid) >=    0) reg = 1;
      else reg = -1;
      
    }

    draw(reg, id, points);
    
  });

  function draw(reg, id, points){
    lineweight = 1;
    if(reg == 1){
      color = 'red';
      lineweight = 10;
    }else if(reg == 0){
      color = 'green';
      lineweight = 10;
    }
    else color = 'blue';


    var line = []
    for(var i = 0; i < points.length; i ++)
      line.push(new BMap.Point(points[i][0], points[i][1]));
    var polyline = new BMap.Polyline(line, {strokeColor:color, strokeWeight:lineweight, strokeOpacity:0}); 
    polyline.addEventListener("click", function(){    
        alert("您点击了轨迹"+id);    
    });
    map.addOverlay(polyline);  
  }
  
  


</script>

